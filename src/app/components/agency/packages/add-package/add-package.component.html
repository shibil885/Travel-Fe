<div class="luxury-form-container">
    <div class="form-header">
        <h1>Create Your Travel Package</h1>
        <p>Design an unforgettable journey for your discerning clients</p>
    </div>

    <form [formGroup]="packageForm" (ngSubmit)="onSubmit()">
        <mat-stepper linear #stepper class="luxury-stepper">
            <mat-step [stepControl]="packageForm.get('packageInfo')!" errorMessage="Please fill in all required fields">
                <ng-template matStepLabel>Info</ng-template>
                <div class="step-content" formGroupName="packageInfo">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name">Package Name</label>
                            <input id="name" type="text" formControlName="name">
                            <div class="error-message"
                                *ngIf="packageForm.get('packageInfo.name')?.touched && packageForm.get('packageInfo.name')?.invalid">
                                <span *ngIf="packageForm.get('packageInfo.name')?.errors?.['required']">Package name is
                                    required</span>
                                <span *ngIf="packageForm.get('packageInfo.name')?.errors?.['minlength']">Package name
                                    must be at least 3 characters long</span>
                            </div>  
                        </div>
                        <div class="form-group">
                            <label for="category" class="block font-semibold text-gray-800 mt-1">Experience
                                Category</label>
                            <div class="relative">
                                <select id="category" formControlName="category"
                                    class="block appearance-none w-full bg-gray-100 border border-gray-300 hover:border-gray-400 text-gray-700 py-4 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-300 ease-in-out">
                                    <option value="" disabled selected>Select a category</option>
                                    <option *ngFor="let category of categories" [value]="category._id">{{category.name}}
                                    </option>
                                </select>
                                <div
                                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 20 20">
                                        <path
                                            d="M5.05 7.05L10 12l4.95-4.95a.5.5 0 10-.707-.707L10 10.586 5.757 6.343a.5.5 0 10-.707.707z" />
                                    </svg>
                                </div>
                                <div class="text-red-500 text-sm mt-1"
                                    *ngIf="packageForm.get('packageInfo.category')?.touched && packageForm.get('packageInfo.category')?.invalid">
                                    <span *ngIf="packageForm.get('packageInfo.category')?.errors?.['required']">Please
                                        select a category</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="country">Country</label>
                            <input id="country" type="text" formControlName="country">
                            <div class="error-message"
                                *ngIf="packageForm.get('packageInfo.country')?.touched && packageForm.get('packageInfo.country')?.invalid">
                                <span *ngIf="packageForm.get('packageInfo.country')?.errors?.['required']">Country is
                                    required</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label for="description">Package Description</label>
                        <textarea id="description" formControlName="description"></textarea>
                        <div class="error-message"
                            *ngIf="packageForm.get('packageInfo.description')?.touched && packageForm.get('packageInfo.description')?.invalid">
                            <span *ngIf="packageForm.get('packageInfo.description')?.errors?.['required']">Description
                                is required</span>
                            <span *ngIf="packageForm.get('packageInfo.description')?.errors?.['minlength']">Description
                                must be at least 10 characters long</span>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" mat-button matStepperNext>Next</button>
                    </div>
                </div>
            </mat-step>

            <mat-step [stepControl]="packageForm.get('travelInfo')!" errorMessage="Please fill in all required fields">
                <ng-template matStepLabel>Details</ng-template>
                <div class="step-content" formGroupName="travelInfo">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="departure">Departure Point</label>
                            <input id="departure" type="text" formControlName="departure">
                            <div class="error-message"
                                *ngIf="packageForm.get('travelInfo.departure')?.touched && packageForm.get('travelInfo.departure')?.invalid">
                                <span *ngIf="packageForm.get('travelInfo.departure')?.errors?.['required']">Departure
                                    point is required</span>
                                <span *ngIf="packageForm.get('travelInfo.departure')?.errors?.['minlength']">Departure
                                    point must be at least 4 characters long</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="finalDestination">Final Destination</label>
                            <input id="finalDestination" type="text" formControlName="finalDestination">
                            <div class="error-message"
                                *ngIf="packageForm.get('travelInfo.finalDestination')?.touched && packageForm.get('travelInfo.finalDestination')?.invalid">
                                <span *ngIf="packageForm.get('travelInfo.finalDestination')?.errors?.['required']">Final
                                    destination is required</span>
                                <span
                                    *ngIf="packageForm.get('travelInfo.finalDestination')?.errors?.['minlength']">Final
                                    destination must be at least 4 characters long</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="price">Price</label>
                            <input id="price" type="text" formControlName="price">
                            <div class="error-message"
                                *ngIf="packageForm.get('travelInfo.price')?.touched && packageForm.get('travelInfo.price')?.invalid">
                                <span *ngIf="packageForm.get('travelInfo.price')?.errors?.['required']">Price is
                                    required</span>
                                <span *ngIf="packageForm.get('travelInfo.price')?.errors?.['pattern']">Please enter a
                                    valid price (e.g., 2999.99)</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="people">Number of People</label>
                            <input id="people" type="text" formControlName="people">
                            <div class="error-message"
                                *ngIf="packageForm.get('travelInfo.people')?.touched && packageForm.get('travelInfo.people')?.invalid">
                                <span *ngIf="packageForm.get('travelInfo.people')?.errors?.['required']">Number of
                                    people is required</span>
                                <span *ngIf="packageForm.get('travelInfo.people')?.errors?.['pattern']">Please enter a
                                    valid number</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="days">Duration (days)</label>
                            <input id="days" type="text" formControlName="days">
                            <div class="error-message"
                                *ngIf="packageForm.get('travelInfo.days')?.touched && packageForm.get('travelInfo.days')?.invalid">
                                <span *ngIf="packageForm.get('travelInfo.days')?.errors?.['required']">Duration is
                                    required</span>
                                <span *ngIf="packageForm.get('travelInfo.days')?.errors?.['pattern']">Please enter a
                                    valid number of days (minimum 1)</span>
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" mat-button matStepperPrevious>Back</button>
                        <button type="button" mat-button matStepperNext>Next</button>
                    </div>
                </div>
            </mat-step>

            <mat-step [stepControl]="packageForm.get('packageFeatures')!"
                errorMessage="Please fill in all required fields">
                <ng-template matStepLabel>Features</ng-template>
                <div class="step-content" formGroupName="packageFeatures">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <h3>Included Items</h3>
                            <div formArrayName="included">
                                <div *ngFor="let item of included?.controls; let i = index" class="included-item">
                                    <div class="input-group">
                                        <input [formControlName]="i">
                                        <button mat-mini-fab class="remove-button" (click)="removeIncludedItem(i)"
                                            *ngIf="included.length > 1">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <div class="error-message" *ngIf="included.at(i).touched && included.at(i).invalid">
                                        <span *ngIf="included.at(i).errors?.['required']">This inclusion is
                                            required</span>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-button" (click)="addIncludedItem()"
                                [disabled]="included.length >= 10">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <h3>Not Included Items</h3>
                            <div formArrayName="notIncluded">
                                <div *ngFor="let item of notIncluded.controls; let i = index" class="not-included-item">
                                    <div class="input-group">
                                        <input [formControlName]="i">
                                        <button type="button" class="remove-button" (click)="removeNotIncludedItem(i)"
                                            *ngIf="notIncluded.length > 1">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <div class="error-message"
                                        *ngIf="notIncluded.at(i).touched && notIncluded.at(i).invalid">
                                        <span *ngIf="notIncluded.at(i).errors?.['required']">This not included item is
                                            required</span>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-button" (click)="addNotIncludedItem()"
                                [disabled]="notIncluded.length >= 10">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" mat-button matStepperPrevious>Back</button>
                        <button type="button" mat-button matStepperNext>Next</button>
                    </div>
                </div>
            </mat-step>

            <mat-step [stepControl]="packageForm.get('tourPlans')!" errorMessage="Please fill in all required fields">
                <ng-template matStepLabel>Plans</ng-template>
                <div class="step-content">
                    <div formArrayName="tourPlans">
                        <div *ngFor="let plan of tourPlans.controls; let i = index" [formGroupName]="i"
                            class="tour-plan">
                            <h3>Day {{i + 1}}</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="tour-plan-title-{{i}}">Title</label>
                                    <input id="tour-plan-title-{{i}}" type="text" formControlName="title">
                                    <div class="error-message"
                                        *ngIf="tourPlans.at(i).get('title')?.touched && tourPlans.at(i).get('title')?.invalid">
                                        <span *ngIf="tourPlans.at(i).get('title')?.errors?.['required']">Title for this
                                            day is required</span>
                                        <span *ngIf="tourPlans.at(i).get('title')?.errors?.['minlength']">Title must be
                                            at least 3 characters long</span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label for="tour-plan-description-{{i}}">Description</label>
                                <textarea id="tour-plan-description-{{i}}" formControlName="description"></textarea>
                                <div class="error-message"
                                    *ngIf="tourPlans.at(i).get('description')?.touched && tourPlans.at(i).get('description')?.invalid">
                                    <span *ngIf="tourPlans.at(i).get('description')?.errors?.['required']">Description
                                        for this day is required</span>
                                    <span *ngIf="tourPlans.at(i).get('description')?.errors?.['minlength']">Description
                                        must be at least 10 characters long</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" mat-button matStepperPrevious>Back</button>
                        <button type="button" mat-button matStepperNext>Next</button>
                    </div>
                </div>
            </mat-step>

            <mat-step>
                <ng-template matStepLabel>Images</ng-template>
                <div class="step-content">
                    <div class="form-group full-width">
                        <label for="image">Package Image</label>
                        <input type="file" id="image" (change)="onFileChange($event)" accept="image/*" #images
                            class="w-1 hidden" hidden multiple [disabled]="selectedImages.length == 6 ? true : false">
                        <span class="text-red-500 text-sm block mb-1" #imageError></span>
                        <a mat-flat-button color="primary" (click)="images.click()" class="flex justify-start mb-2"
                            [disabled]="selectedImages.length == 6 ? true : false">
                            <mat-icon>
                                add
                            </mat-icon>
                            <mat-icon>
                                imagesmode
                            </mat-icon>
                        </a>
                        <div class="error-message"
                            *ngIf="packageForm.get('image')?.touched && packageForm.get('image')?.invalid">
                            <span *ngIf="packageForm.get('image')?.errors?.['required']">Please upload an image for the
                                package</span>
                        </div>
                        <div class="flex flex-wrap gap-4 justify-start">
                            <div *ngFor="let file of selectedImages; let i = index" class="relative w-40 h-40 group">
                                <img [src]="file" alt="Package Preview" class="w-full h-full object-cover rounded-lg">
                                <div
                                    class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    <i class="fas fa-trash text-white text-xl cursor-pointer mx-2 hover:text-red-500"
                                        (click)="deleteImage(i)"></i>
                                    <input type="file" accept="image/*" class="w-1 hidden" hidden #replaceImageInput
                                        (change)="replaceImage($event, i)">
                                    <i class="fas fa-sync text-white text-xl cursor-pointer mx-2 hover:text-blue-500"
                                        (click)="replaceImageInput.click()"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" matStepperPrevious>Back</button>
                        <button type="submit" class="submit-button">Create</button>
                    </div>
                </div>
            </mat-step>
        </mat-stepper>
    </form>
</div>